<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GPA & CGPA Calculator – AU R2021 (CSE)</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #ffffff;
  margin: 0;
  padding: 0;
  color: #222;
}
.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}
h1, h2 {
  text-align: center;
}
.card {
  border: 1px solid #ddd;
  padding: 20px;
  border-radius: 8px;
  margin-top: 20px;
}
label {
  display: block;
  margin-top: 12px;
  font-weight: bold;
}
input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
}
button {
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
button:hover {
  background: #1e40af;
}
.hidden {
  display: none;
}
.footer {
  text-align: center;
  margin-top: 40px;
  font-size: 14px;
}
.footer a {
  margin: 0 8px;
  text-decoration: none;
}
</style>
</head>

<body>
<div class="container">

<!-- WELCOME -->
<div id="page-welcome" class="card">
  <h1>GPA & CGPA Calculator</h1>
  <p style="text-align:center">
    Computer Science & Engineering<br/>
    Anna University – Regulation 2021
  </p>

  <label>Name</label>
  <input id="studentName" placeholder="Enter your name" />

  <label>Email</label>
  <input id="studentEmail" type="email" placeholder="Enter your email" />

  <label>Number of semesters completed</label>
  <select id="semesterCount">
    <option value="">Select</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
  </select>

  <button onclick="startApp()">Continue</button>
</div>

<!-- GPA PAGE -->
<div id="page-gpa" class="card hidden">
  <h2 id="gpa-title"></h2>
  <div id="subjects"></div>
  <button onclick="calculateGPA()">Calculate GPA</button>
  <h3 id="gpa-result"></h3>
  <button id="cgpaBtn" class="hidden">Next</button>
  <button onclick="backToMenu()">Back to Menu</button>
</div>

<!-- CGPA PAGE -->
<div id="page-cgpa" class="card hidden">
  <h2>CGPA Calculation</h2>
  <div id="cgpaInputs"></div>
  <button onclick="calculateCGPA()">Calculate CGPA</button>
  <h3 id="cgpa-result"></h3>
  <button onclick="backToMenu()">Back to Menu</button>
</div>

<div class="footer">
  This is created by <strong>Zia Anas</strong><br/><br/>
  <a href="https://wa.me/919363645734" target="_blank">WhatsApp</a>
  <a href="https://instagram.com/m_zia_anas" target="_blank">Instagram</a>
  <a href="https://linkedin.com/in/zia-anes-m" target="_blank">LinkedIn</a>
  <a href="tel:+919363645734">Call</a>
</div>

</div>

<script>
/* ===== DOM REFERENCES (THIS WAS MISSING BEFORE) ===== */
const pageWelcome = document.getElementById("page-welcome");
const pageGPA = document.getElementById("page-gpa");
const pageCGPA = document.getElementById("page-cgpa");
const gpaTitle = document.getElementById("gpa-title");
const subjects = document.getElementById("subjects");
const gpaResult = document.getElementById("gpa-result");
const cgpaBtn = document.getElementById("cgpaBtn");
const cgpaInputs = document.getElementById("cgpaInputs");
const cgpaResult = document.getElementById("cgpa-result");

/* ===== GOOGLE FORM CONFIG (CORRECT FORMAT) ===== */
const GOOGLE_FORM_URL =
  "https://docs.google.com/forms/d/13G9VlVwCaFFxzv--nK_RYLLyAFctqsxvm4JjzZxCZuQ/formResponse";

/* ===== DATA ===== */
const gradeMap = { O:10, A+:9, A:8, B+:7, B:6, C:5, U:0 };

const semesters = {
  1:{credits:22,subjects:[
    ["HS3151 Professional English – I",2],
    ["MA3151 Matrices and Calculus",4],
    ["PH3151 Engineering Physics",3],
    ["CY3151 Engineering Chemistry",3],
    ["GE3151 Python Programming",3],
    ["GE3152 Engineering Graphics",4],
    ["GE3171 Python Lab",2],
    ["BS3171 Physics & Chemistry Lab",1]
  ]},
  2:{credits:26,subjects:[
    ["HS3252 Professional English – II",2],
    ["MA3251 Statistics",4],
    ["PH3256 Physics for IS",3],
    ["BE3251 BEEE",3],
    ["GE3251 Engineering Graphics",4],
    ["CS3251 Programming in C",3],
    ["GE3271 Engineering Practices Lab",2],
    ["CS3271 C Lab",2],
    ["GE3272 Communication Lab",2],
    ["GE3252 Tamil",1]
  ]}
};

let appState = {name:"",email:"",completed:0,gpas:{}};

/* ===== FUNCTIONS ===== */
function sendUsage(name,email){
  const d = new URLSearchParams();
  d.append("entry.782499053",name);
  d.append("entry.1195044287",email);
  fetch(GOOGLE_FORM_URL,{method:"POST",mode:"no-cors",body:d});
}

function startApp(){
  const name = studentName.value.trim();
  const email = studentEmail.value.trim();
  const count = semesterCount.value;

  if(!name||!email||!count){alert("Fill all fields");return;}

  appState={name,email,completed:+count,gpas:{}};
  sendUsage(name,email);
  loadSemester(1);
}

function loadSemester(sem){
  resetPages();
  pageGPA.classList.remove("hidden");
  gpaTitle.innerText=`Semester ${sem} GPA – ${appState.name}`;
  subjects.innerHTML="";
  semesters[sem].subjects.forEach((s,i)=>{
    subjects.innerHTML+=`
      <label>${s[0]} (${s[1]} credits)</label>
      <select id="g${i}">
        <option value="">Select</option>
        <option>O</option><option>A+</option><option>A</option>
        <option>B+</option><option>B</option><option>C</option><option>U</option>
      </select>`;
  });
  pageGPA.dataset.sem=sem;
}

function calculateGPA(){
  const sem=pageGPA.dataset.sem;
  let t=0,c=0;
  semesters[sem].subjects.forEach((s,i)=>{
    const g=document.getElementById("g"+i).value;
    if(!g)return;
    t+=gradeMap[g]*s[1];
    c+=s[1];
  });
  const gpa=(t/c).toFixed(3);
  appState.gpas[sem]=gpa;
  gpaResult.innerText=`Semester ${sem} GPA: ${gpa}`;
}

function calculateCGPA(){
  let t=0,c=0;
  Object.keys(appState.gpas).forEach(s=>{
    t+=appState.gpas[s]*semesters[s].credits;
    c+=semesters[s].credits;
  });
  cgpaResult.innerText=`CGPA: ${(t/c).toFixed(3)}`;
}

function backToMenu(){
  resetPages();
  pageWelcome.classList.remove("hidden");
}

function resetPages(){
  pageWelcome.classList.add("hidden");
  pageGPA.classList.add("hidden");
  pageCGPA.classList.add("hidden");
}
</script>
</body>
</html>
